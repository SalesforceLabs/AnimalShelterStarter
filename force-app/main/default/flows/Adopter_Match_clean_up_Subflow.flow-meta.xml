<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Sends an email when both inputs are Null</description>
        <name>Send_Email_on_Error</name>
        <label>Send Email on Error</label>
        <locationX>1546</locationX>
        <locationY>242</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>ErrorMessageOnNullValues</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$User.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>An occurred in the Adopter Matching Flow</stringValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>59.0</apiVersion>
    <assignments>
        <name>Assign_AM_records_to_Delete_Not_Adopted_Path</name>
        <label>Assign AM records to Delete - Not Adopted Path</label>
        <locationX>490</locationX>
        <locationY>566</locationY>
        <assignmentItems>
            <assignToReference>adoptionMatchRecordstoDelete</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Adoption_Match_records_related_to_Animal</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Are_there_Adoption_Match_records_to_delete</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_to_AM_record_to_Update</name>
        <label>Assign to AM record to Update</label>
        <locationX>314</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>amRecordtoUpdate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Through_Adoption_Match_records</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Through_Adoption_Match_records</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Build_AM_records_to_delete</name>
        <label>Build AM records to delete</label>
        <locationX>578</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>adoptionMatchRecordstoDelete</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Through_Adoption_Match_records</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Through_Adoption_Match_records</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Status_on_AM_record</name>
        <label>Update Status on AM record</label>
        <locationX>226</locationX>
        <locationY>1058</locationY>
        <assignmentItems>
            <assignToReference>amRecordtoUpdate.Successful_Adoption__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_AM_record_for_Adopter</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Any_Adoption_Match_records_to_delete</name>
        <label>Any Adoption Match records to delete?</label>
        <locationX>1150</locationX>
        <locationY>350</locationY>
        <defaultConnectorLabel>No records to Delete</defaultConnectorLabel>
        <rules>
            <name>Records_to_Delete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Adoption_Match_records_related_to_Adopter_Profile</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_Adoption_Match_records</targetReference>
            </connector>
            <label>Records to Delete</label>
        </rules>
    </decisions>
    <decisions>
        <name>Are_there_Adoption_Match_records_to_delete</name>
        <label>Are there Adoption Match records to delete?</label>
        <locationX>490</locationX>
        <locationY>1358</locationY>
        <defaultConnectorLabel>No records to delete</defaultConnectorLabel>
        <rules>
            <name>Yes_records_to_delete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>adoptionMatchRecordstoDelete</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_Adoption_Matches</targetReference>
            </connector>
            <label>Yes records to delete</label>
        </rules>
    </decisions>
    <decisions>
        <name>Does_the_Contact_on_the_Animal_match_the_Adopter_Profile</name>
        <label>Does the Contact on the Animal match the Adopter Profile</label>
        <locationX>446</locationX>
        <locationY>674</locationY>
        <defaultConnector>
            <targetReference>Build_AM_records_to_delete</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Contacts Don&apos;t Match</defaultConnectorLabel>
        <rules>
            <name>Matches</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Through_Adoption_Match_records.Adopter_Profile_Contact_Id__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>animalRecord.Previous_Current_Owner__r.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_to_AM_record_to_Update</targetReference>
            </connector>
            <label>Contacts Match</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines which object this subflow was called from by looking at which records were passed.</description>
        <name>Flow_triggered_by_which_object</name>
        <label>Flow triggered by which object</label>
        <locationX>798</locationX>
        <locationY>134</locationY>
        <defaultConnector>
            <targetReference>Send_Email_on_Error</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Error</defaultConnectorLabel>
        <rules>
            <name>Animal</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>animalRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>adopterProfile</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Adoption_Match_records_related_to_Animal</targetReference>
            </connector>
            <label>Animal</label>
        </rules>
        <rules>
            <name>Adopter_Profile</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>adopterProfile</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>animalRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Adoption_Match_records_related_to_Adopter_Profile</targetReference>
            </connector>
            <label>Adopter Profile</label>
        </rules>
    </decisions>
    <decisions>
        <name>No_AM_records_related_to_Animal</name>
        <label>No AM records related to Animal</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <defaultConnector>
            <targetReference>What_is_the_status_of_the_animal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Records to clean up</defaultConnectorLabel>
        <rules>
            <name>No_record_to_clean_up</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Adoption_Match_records_related_to_Animal</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>No record to clean up</label>
        </rules>
    </decisions>
    <decisions>
        <name>What_is_the_status_of_the_animal</name>
        <label>What is the status of the animal?</label>
        <locationX>490</locationX>
        <locationY>458</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Adopted</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>animalRecord.Animal_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Adopted</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Through_Adoption_Match_records</targetReference>
            </connector>
            <label>Adopted</label>
        </rules>
        <rules>
            <name>No_longer_Available_for_Adoption</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>animalRecord.Animal_Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Adopted</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>animalRecord.Animal_Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Available for Adoption</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_AM_records_to_Delete_Not_Adopted_Path</targetReference>
            </connector>
            <label>No longer Available for Adoption</label>
        </rules>
    </decisions>
    <description>[Animal Shelter] cleans up of records in the Adoption Match object if certain changes happen to the Adopter Profile or Animal</description>
    <environments>Default</environments>
    <interviewLabel>Adopter Match - clean up - Subflow {!$Flow.CurrentDateTime}</interviewLabel>
    <isTemplate>true</isTemplate>
    <label>Adopter Match - Record Clean Up - Subflow</label>
    <loops>
        <name>Loop_Through_Adoption_Match_records</name>
        <label>Loop Through Adoption Match records</label>
        <locationX>226</locationX>
        <locationY>566</locationY>
        <collectionReference>Get_Adoption_Match_records_related_to_Animal</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Does_the_Contact_on_the_Animal_match_the_Adopter_Profile</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Status_on_AM_record</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordDeletes>
        <name>Delete_Adoption_Match_records</name>
        <label>Delete Adoption Match records</label>
        <locationX>1018</locationX>
        <locationY>458</locationY>
        <inputReference>Get_Adoption_Match_records_related_to_Adopter_Profile</inputReference>
    </recordDeletes>
    <recordDeletes>
        <description>Delete Adoption Match records that are no longer valid</description>
        <name>Delete_Adoption_Matches</name>
        <label>Delete Adoption Matches</label>
        <locationX>358</locationX>
        <locationY>1466</locationY>
        <inputReference>adoptionMatchRecordstoDelete</inputReference>
    </recordDeletes>
    <recordLookups>
        <description>Returns the Adoption Match records related to the Adopter Profile Id</description>
        <name>Get_Adoption_Match_records_related_to_Adopter_Profile</name>
        <label>Get Adoption Match records related to Adopter Profile</label>
        <locationX>1150</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Any_Adoption_Match_records_to_delete</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Adopter_Profile__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>adopterProfile.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Successful_Adoption__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Adoption_Match__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Returns the Adoption Match records that match the animal Id</description>
        <name>Get_Adoption_Match_records_related_to_Animal</name>
        <label>Get Adoption Match records related to Animal</label>
        <locationX>50</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>No_AM_records_related_to_Animal</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Animal__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>animalRecord.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Adoption_Match__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_AM_record_for_Adopter</name>
        <label>Update AM record for Adopter</label>
        <locationX>226</locationX>
        <locationY>1166</locationY>
        <connector>
            <targetReference>Are_there_Adoption_Match_records_to_delete</targetReference>
        </connector>
        <inputReference>amRecordtoUpdate</inputReference>
    </recordUpdates>
    <runInMode>DefaultMode</runInMode>
    <start>
        <locationX>672</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Flow_triggered_by_which_object</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>ErrorMessageOnNullValues</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Error: {!$Flow.FaultMessage} at &lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;{!$Flow.CurrentDateTime}&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Expected inputs are Null!&lt;/p&gt;&lt;p&gt;Either an animal record or adopter profile should be passed to this subflow.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Please contact your Systems Administrator&lt;/p&gt;</text>
    </textTemplates>
    <variables>
        <name>adopterProfile</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Adopter_Profile__c</objectType>
    </variables>
    <variables>
        <name>adoptionMatchRecordstoDelete</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Adoption_Match__c</objectType>
    </variables>
    <variables>
        <name>amRecordtoUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Adoption_Match__c</objectType>
    </variables>
    <variables>
        <name>animalRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Animal__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Adoption_Matches_that_Match_Primary_Contact_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Adoption_Match__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_by_Not_Equal_to_Primary_Contact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Adoption_Match__c</objectType>
    </variables>
    <variables>
        <name>testRecords</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Adoption_Match__c</objectType>
    </variables>
</Flow>
